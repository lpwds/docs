高速传输
=================================

.. toctree::
   :maxdepth: 2
   :caption: Contents:
   
=======================
1. 简介
=======================
LPWDS基础功能是提供一个高抗干扰、高可靠、低功耗的跳频连接。
该连接收到功耗和跳频的限制，所发的数据包大小和数量有限。
LPWDS系统为了满足用户对于传输图片或有一定数据量的数据传输，而实现了高速传输功能。
LPWDS高速传输功能不受时间限制，打个数据包大小可达220个字节。

LPWDS高速传输实现过程：
    1. 用户首先使用基站模块和节点模块见的低功耗连接，开启节点的高速通道。
    2. 节点的高速通道开启后，用户通过接入点模块向节点模块发送高速数据。
    3. 节点模块不能主动向接入点模块发送高速数据。
    4. 如果有节点模块向接入点发送高速数据的需求，也应有接入点模块向节点请求高速数据。


=======================
2. 高速通道开启
=======================
高速通道的开启占用了下面2个Profile，用户可用再使用以下的Profile

.. code:: c

    #define CMC_HS_PROFILE                  0xFFFFFF01
    #define CMC_HS_BROADCAST_PROFILE        0xFFFFFF02

开启方法

.. code:: bash

    127.0.0.1:6379> publish pipe.command 40F87D940F7C01FFFFFF011234
    (integer) 1
    #向节点模块“40F87D940F7C”发送高速通道开启指令
    #节点模块收到该指令后，开启高速通道，并返回
    1) "pmessage"
    2) "pipe.message"
    3) "pipe.message"
    4) "40F87D940F7C03FFFFFF0100001600"
    #40F87D940F7C03FFFFFF0100001600
    #40F87D940F7C 节点模块MAC地址
    #            03 消息类型：数据
    #              FFFFFF01 PROFILE
    #                      00001600 
    #                          16 高速通道使用的频点
    #                             


=======================
3. 高速数据下发
=======================
高速数据下发是通过接入点模块实现的。

下发方法

.. code:: bash

    #publish("pipe.ap.command", ap_addr+"C300"+node_addr+ap_chan+msg_id+ack_token+demo_payload)
    127.0.0.1:6379> publish pipe.ap.command A507B6A44B1CC30040F87D940F7C1600CC00000000183b0020490301005103010053030100550301005703010059030100000000000000000000000000000000005b0301005d030100000000005f030100610301006303010063030100c51f0100630301006303010000000000a11d010063030100630301006303010063030100630301006303010063030100630301006303010063030100630301006303010063030100e51d010063030100630301006303010063030100630301000000000000000000630301006303010000000000000000000000000000000000
    (integer) 1
    #向节点模块“40F87D940F7C”发送高速数据
    #A507B6A44B1CC30040F87D940F7C1600CC00000000183b0020490301005103010053030100550301005703010059030100000000000000000000000000000000005b0301005d030100000000005f030100610301006303010063030100c51f0100630301006303010000000000a11d010063030100630301006303010063030100630301006303010063030100630301006303010063030100630301006303010063030100e51d010063030100630301006303010063030100630301000000000000000000630301006303010000000000000000000000000000000000
    #A507B6A44B1C 接入点模块MAC地址
    #            C300 消息头
    #                40F87D940F7C 节点模块的MAC地址
    #                            16 节点模块高速通道使用的频点
    #                              00CC 发向节点模块的高速数据的ID，需不同，或置零
    #                                  0000 来自节点模块的消息ID的返回
    #                                      其余的均是要发送的实际高速数据

节点模块收到高速数据后会给接入点模块一个返回

.. code:: bash

    1) "pmessage"
    2) "*"
    3) "pipe.ap.message"
    4) "C4A507B6A44B1C40F87D940F7C0000CC000068B2"
    #C4A507B6A44B1C40F87D940F7C0000CC000068B2
    #C4 消息头：
    #  A507B6A44B1C 接入点模块MAC地址
    #              40F87D940F7C 节点模块MAC地址
    #                          00 节点模块返回确认消息：00: OK, 01: timeout, 02: busy, 03: timeout
    #                            00CC 接入点模块发向节点模块的消息ID
    #                                0000 节点模块向接入点模块发送数据的消息ID
    #                                    68B2 校验位， 丢弃掉，无需关心
